<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pooh's Honey Barrel ‚Äì Next Level Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="description" content="Catch the falling honey, dodge the bees, and help Pooh fill his honey barrel in this storybook-style mini game." />
  <meta name="theme-color" content="#f7c948" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Playfair+Display:wght@400;600;700&family=Schoolbell&display=swap" rel="stylesheet" />

  <style>
    :root {
      --pooh-yellow: #f7c948;
      --pooh-deep-yellow: #f2a93b;
      --pooh-red: #e65a3b;
      --pooh-brown: #5a3b21;
      --pooh-brown-soft: #7a5533;
      --honey-gold: #ffdd75;
      --honey-amber: #f3b547;
      --honey-light: #fff7dd;
      --forest-green: #7fbf7f;
      --sky-blue: #b9e6ff;
      --cream: #fffaf0;
      --ink: #2b1b12;
      --muted-ink: #5b4637;
      --page-shadow: 0 24px 60px rgba(44, 20, 6, 0.25);
      --card-shadow: 0 16px 40px rgba(44, 20, 6, 0.2);
      --soft-shadow: 0 10px 28px rgba(44, 20, 6, 0.18);
      --radius-lg: 26px;
      --radius-md: 18px;
      --radius-pill: 999px;
      --transition-fast: 0.18s ease-out;
      --transition-med: 0.28s cubic-bezier(0.19, 1, 0.22, 1);
      --success: #3fbf6b;
      --danger: #f25c54;
      --warning: #ffb347;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at top left, #ffe9b8 0, transparent 55%),
        radial-gradient(circle at bottom right, #c5ecff 0, transparent 55%),
        linear-gradient(180deg, #fffaf0 0, #ffeccd 45%, #fffaf0 100%);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      padding: 0.75rem;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.5) 0, transparent 55%),
        radial-gradient(circle at 88% 0, rgba(255, 255, 255, 0.4) 0, transparent 50%);
      opacity: 0.7;
      pointer-events: none;
      z-index: -1;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      font-family: inherit;
    }

    .skip-link {
      position: absolute;
      left: 50%;
      transform: translate(-50%, -200%);
      background: var(--ink);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-pill);
      z-index: 50;
      transition: transform var(--transition-fast), opacity var(--transition-fast);
      opacity: 0;
    }

    .skip-link:focus-visible {
      transform: translate(-50%, 0.5rem);
      opacity: 1;
      outline: none;
    }

    .shell {
      max-width: 1100px;
      margin: 0 auto;
      background: rgba(255, 247, 230, 0.96);
      border-radius: 32px;
      box-shadow: var(--page-shadow);
      padding: 1.25rem 1.25rem 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: -80px -20px auto;
      height: 130px;
      background:
        linear-gradient(180deg, rgba(247, 201, 72, 0.92), rgba(241, 153, 57, 0.92));
      clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 80% 80%, 70% 100%, 60% 80%, 50% 100%, 40% 78%, 30% 100%, 20% 77%, 10% 100%, 0 75%);
      opacity: 0.9;
      z-index: -1;
    }

    .shell::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.5) 0, transparent 45%),
        radial-gradient(circle at 88% 0, rgba(255, 255, 255, 0.4) 0, transparent 50%);
      pointer-events: none;
      opacity: 0.9;
      z-index: -1;
    }

    header.story-hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.2rem;
      position: relative;
      z-index: 1;
    }

    .hero-text {
      flex: 1.1;
      color: #3b2414;
    }

    .hero-kicker {
      font-family: "Schoolbell", system-ui;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #4f2b14;
      margin-bottom: 0.4rem;
    }

    .hero-title {
      font-family: "Playfair Display", "Times New Roman", serif;
      font-weight: 700;
      font-size: clamp(1.9rem, 3vw, 2.3rem);
      line-height: 1.1;
      margin-bottom: 0.35rem;
      text-shadow: 0 3px 0 rgba(255, 255, 255, 0.6);
    }

    .hero-subtitle {
      font-size: 0.98rem;
      color: var(--muted-ink);
      max-width: 30rem;
    }

    .hero-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.7rem;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 6px 16px rgba(101, 67, 33, 0.18);
      color: #5d3a1f;
      white-space: nowrap;
    }

    .pill i {
      font-size: 0.9em;
    }

    .hero-figure {
      flex: 0.9;
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .bear-card {
      position: relative;
      width: 170px;
      height: 170px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffe7b0 0, #f7c948 35%, #f3a645 55%, #e07b39 90%);
      box-shadow: 0 18px 40px rgba(59, 27, 9, 0.4);
      overflow: hidden;
    }

    .bear-inner {
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      background: radial-gradient(circle at 20% 0, #ffeec1 0, #f9c35b 40%, #f3a645 75%);
    }

    .bear-ears::before,
    .bear-ears::after {
      content: "";
      position: absolute;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: #f5b639;
      top: 6px;
      box-shadow: inset 0 0 0 4px rgba(255, 237, 190, 0.9);
    }

    .bear-ears::before {
      left: 30px;
    }

    .bear-ears::after {
      right: 30px;
    }

    .bear-face {
      position: absolute;
      inset: 42px 34px 40px;
      border-radius: 40px;
      background: radial-gradient(circle at 50% 0, #ffe9b2 0, #f5c35c 72%);
      box-shadow: 0 8px 20px rgba(102, 72, 39, 0.35);
    }

    .bear-eyes::before,
    .bear-eyes::after {
      content: "";
      position: absolute;
      top: 26px;
      width: 7px;
      height: 14px;
      border-radius: 7px;
      background: #3b2414;
      box-shadow: 0 4px 0 rgba(255, 210, 140, 0.7);
    }

    .bear-eyes::before {
      left: 22px;
    }

    .bear-eyes::after {
      right: 22px;
    }

    .bear-nose {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 28px;
      height: 22px;
      background: radial-gradient(circle at 50% 0, #7c4a2a 0, #3b2414 65%);
      border-radius: 16px 16px 18px 18px;
      box-shadow: 0 6px 10px rgba(102, 72, 39, 0.5);
    }

    .bear-mouth {
      position: absolute;
      top: 55px;
      left: 50%;
      width: 54px;
      height: 26px;
      border-radius: 0 0 40px 40px;
      border-bottom: 3px solid #3b2414;
      border-left: 3px solid transparent;
      border-right: 3px solid transparent;
      transform: translateX(-50%);
    }

    .bear-shirt {
      position: absolute;
      bottom: -4px;
      left: -8px;
      right: -8px;
      height: 54px;
      background: linear-gradient(180deg, #f06a47 0, #c3372e 90%);
      border-radius: 26px 26px 40px 40px;
      box-shadow: 0 -6px 12px rgba(255, 211, 156, 0.7);
    }

    .bear-barrel {
      position: absolute;
      bottom: -4px;
      right: -10px;
      width: 70px;
      height: 70px;
      border-radius: 30px;
      background: radial-gradient(circle at 20% 20%, #ffe7b0 0, #f3a645 40%, #c06a2b 80%);
      box-shadow: 0 10px 24px rgba(59, 27, 9, 0.55);
      transform: rotate(-12deg);
      overflow: hidden;
    }

    .bear-barrel::before {
      content: "";
      position: absolute;
      inset: 18px 8px 16px;
      border-radius: 18px;
      border: 3px solid rgba(85, 40, 12, 0.55);
      box-shadow: 0 0 0 3px rgba(255, 221, 165, 0.7) inset;
    }

    .bear-barrel::after {
      content: "";
      position: absolute;
      inset: auto 10px 0;
      height: 18px;
      border-radius: 14px 14px 0 0;
      background: linear-gradient(180deg, #ffd76b 0, #f2a93b 60%, #e26f33 100%);
    }

    main {
      position: relative;
      z-index: 1;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 0.95fr);
      gap: 1.25rem;
      align-items: stretch;
    }

    .panel {
      background: linear-gradient(145deg, rgba(255, 252, 244, 0.98), rgba(255, 239, 207, 0.98));
      border-radius: var(--radius-lg);
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(163, 126, 83, 0.18);
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.75) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.32) 0, transparent 55%);
      pointer-events: none;
      opacity: 0.9;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.6rem;
      margin-bottom: 0.75rem;
    }

    .panel-title {
      font-family: "Playfair Display", serif;
      font-size: 1.18rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
      color: #4b2f1a;
    }

    .panel-title span.icon {
      display: inline-flex;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 10%, #fff7cd 0, #f7c948 38%, #f2a93b 70%);
      box-shadow: 0 6px 16px rgba(59, 27, 9, 0.4);
      font-size: 1.15rem;
    }

    .badge-soft {
      font-size: 0.72rem;
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px dashed rgba(141, 94, 58, 0.45);
      color: #6a4831;
      white-space: nowrap;
    }

    .game-shell {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .stat-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: space-between;
    }

    .stat-group-main {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    .stat-chip {
      min-width: 90px;
      padding: 0.45rem 0.75rem;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.95);
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(161, 118, 75, 0.19);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .stat-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #8a6647;
      margin-bottom: 0.1rem;
    }

    .stat-value {
      font-weight: 700;
      font-size: 1rem;
      color: #3c2515;
    }

    .stat-value span.small {
      font-size: 0.8em;
      font-weight: 500;
      margin-left: 0.15rem;
      color: #8a6647;
    }

    .lives-indicator {
      display: flex;
      gap: 0.15rem;
      align-items: center;
    }

    .heart {
      width: 14px;
      height: 12px;
      background:
        radial-gradient(circle at 30% 30%, #ffe4d9 0, #ff7d7d 40%, #e94057 80%);
      clip-path: path("M7 12 C 5 10, 1 7.5, 1 4.5 C 1 2.5, 2.5 1, 4 1 C 5 1, 6 1.5, 7 2.4 C 8 1.5, 9 1, 10 1 C 11.5 1, 13 2.5, 13 4.5 C 13 7.5, 9 10, 7 12 Z");
      box-shadow: 0 3px 6px rgba(233, 64, 87, 0.45);
    }

    .heart.lost {
      filter: grayscale(0.85);
      opacity: 0.35;
      box-shadow: none;
    }

    .chip-secondary {
      padding: 0.35rem 0.7rem;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.9);
      border: 1px dashed rgba(151, 110, 70, 0.6);
      font-size: 0.78rem;
      color: #6a4831;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
    }

    .chip-secondary svg {
      width: 14px;
      height: 14px;
    }

    .game-canvas-shell {
      position: relative;
      border-radius: 24px;
      padding: 0.6rem;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.85) 0, transparent 50%),
                  radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.7) 0, transparent 55%),
                  linear-gradient(180deg, #ffeccb, #ffd38f);
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(156, 118, 76, 0.35);
    }

    .game-canvas-wrapper {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      background: linear-gradient(180deg, #b6e5ff 0, #fef7d4 40%, #ffe3a0 80%, #f3b261 100%);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.75);
      aspect-ratio: 16 / 9;
    }

    canvas#gameCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .game-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1rem;
      background: radial-gradient(circle at 50% 0, rgba(255, 255, 255, 0.92) 0, rgba(255, 250, 236, 0.96) 50%, rgba(255, 246, 223, 0.98) 100%);
      color: #4f321d;
      transition: opacity var(--transition-med), visibility var(--transition-med);
    }

    .game-overlay.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .overlay-title {
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      margin-bottom: 0.3rem;
    }

    .overlay-subtitle {
      font-size: 0.9rem;
      color: #7a5533;
      max-width: 21rem;
      margin: 0 auto 0.75rem;
    }

    .overlay-stat-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      font-size: 0.85rem;
    }

    .overlay-stat {
      padding: 0.4rem 0.7rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(151, 110, 70, 0.4);
      box-shadow: 0 6px 14px rgba(101, 67, 33, 0.18);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      justify-content: center;
    }

    .btn {
      --btn-bg: #f7c948;
      --btn-bg-hover: #f2a93b;
      --btn-color: #3b2414;
      border: none;
      background: linear-gradient(135deg, var(--btn-bg), var(--btn-bg-hover));
      color: var(--btn-color);
      padding: 0.46rem 0.95rem;
      border-radius: var(--radius-pill);
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 10px 20px rgba(153, 96, 38, 0.4);
      transform: translateY(0);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast), background var(--transition-med);
    }

    .btn span.icon {
      font-size: 1rem;
    }

    .btn:hover {
      transform: translateY(-1.5px);
      box-shadow: 0 14px 26px rgba(153, 96, 38, 0.46);
      filter: brightness(1.02);
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 14px rgba(153, 96, 38, 0.38);
      filter: brightness(0.98);
    }

    .btn-ghost {
      --btn-bg: rgba(255, 255, 255, 0.9);
      --btn-bg-hover: rgba(255, 255, 255, 1);
      --btn-color: #6a4831;
      border: 1px dashed rgba(161, 118, 75, 0.7);
      box-shadow: 0 6px 14px rgba(101, 67, 33, 0.26);
      padding-inline: 0.85rem;
      font-weight: 600;
    }

    .btn-small {
      font-size: 0.78rem;
      padding: 0.32rem 0.7rem;
      box-shadow: 0 7px 14px rgba(101, 67, 33, 0.3);
    }

    .btn-primary {
      --btn-bg: #f2a93b;
      --btn-bg-hover: #f2b84d;
    }

    .btn-danger {
      --btn-bg: #f25c54;
      --btn-bg-hover: #f27c54;
      --btn-color: #fff;
    }

    .control-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.65rem;
    }

    .control-group-main {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
    }

    .control-group-secondary {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
    }

    .difficulty-toggle {
      display: inline-flex;
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--radius-pill);
      padding: 0.18rem;
      box-shadow: 0 7px 18px rgba(101, 67, 33, 0.22);
    }

    .difficulty-toggle button {
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 0.24rem 0.6rem;
      font-size: 0.78rem;
      font-weight: 600;
      color: #7a5533;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .difficulty-toggle button.active {
      background: linear-gradient(135deg, #f2a93b, #f2b84d);
      color: #3b2414;
      box-shadow: 0 6px 12px rgba(153, 96, 38, 0.5);
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
      font-size: 0.8rem;
      color: #7a5533;
    }

    .toggle input {
      display: none;
    }

    .toggle-pill {
      width: 32px;
      height: 18px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(163, 126, 83, 0.65);
      position: relative;
      box-shadow: 0 4px 10px rgba(101, 67, 33, 0.25) inset;
    }

    .toggle-thumb {
      position: absolute;
      width: 14px;
      height: 14px;
      top: 1.2px;
      left: 2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffe9b2, #f7c948);
      box-shadow: 0 4px 10px rgba(99, 66, 33, 0.7);
      transition: transform var(--transition-fast);
    }

    .toggle input:checked + .toggle-pill .toggle-thumb {
      transform: translateX(12px);
    }

    .mobile-controls {
      display: none;
      margin-top: 0.55rem;
      gap: 0.4rem;
    }

    .mobile-controls button {
      flex: 1;
      padding: 0.7rem 0.4rem;
      font-size: 1rem;
      border-radius: 16px;
    }

    .story-shell {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .storybook-card {
      background: repeating-linear-gradient(
        90deg,
        rgba(255, 248, 230, 0.95) 0,
        rgba(255, 248, 230, 0.95) 12px,
        rgba(252, 228, 196, 0.9) 12px,
        rgba(252, 228, 196, 0.9) 13px
      );
      border-radius: 22px;
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(179, 141, 103, 0.35);
      padding: 0.8rem 0.9rem;
      position: relative;
      overflow: hidden;
    }

    .storybook-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.7) 0, transparent 55%);
      pointer-events: none;
    }

    .storybook-heading {
      font-family: "Schoolbell", system-ui;
      font-size: 1rem;
      margin-bottom: 0.2rem;
      color: #4f2b14;
    }

    .storybook-title {
      font-family: "Playfair Display", serif;
      font-size: 1.15rem;
      margin-bottom: 0.25rem;
      color: #3b2414;
    }

    .storybook-body {
      font-size: 0.9rem;
      color: #5a3b21;
      line-height: 1.45;
    }

    .storybook-body p + p {
      margin-top: 0.35rem;
    }

    .storybook-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #7a5533;
    }

    .storybook-tagline {
      font-style: italic;
    }

    .tip-list {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.85rem;
      color: #5d3a1f;
    }

    .tip-item {
      display: flex;
      gap: 0.35rem;
      align-items: flex-start;
    }

    .tip-icon {
      margin-top: 0.08rem;
      font-size: 0.9rem;
    }

    .tip-label {
      font-weight: 600;
    }

    .status-bar {
      margin-top: 0.6rem;
      padding: 0.4rem 0.7rem;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 18px rgba(116, 81, 52, 0.15);
      font-size: 0.78rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #7a5533;
      gap: 0.4rem;
    }

    .status-bar span.label {
      font-weight: 600;
      color: #4f2b14;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(63, 191, 107, 0.25);
    }

    .status-bar[data-state="paused"] .status-dot {
      background: var(--warning);
      box-shadow: 0 0 0 4px rgba(255, 179, 71, 0.25);
    }

    .status-bar[data-state="idle"] .status-dot {
      background: #bbb09a;
      box-shadow: 0 0 0 4px rgba(187, 176, 154, 0.25);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 1rem;
      transform: translateX(-50%) translateY(120%);
      background: rgba(59, 27, 9, 0.94);
      color: #fff7e0;
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 16px 40px rgba(30, 10, 3, 0.7);
      z-index: 40;
      pointer-events: none;
      opacity: 0;
      transition: transform var(--transition-med), opacity var(--transition-med);
    }

    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .toast span.icon {
      font-size: 0.95rem;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(41, 24, 12, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
      padding: 1rem;
    }

    .modal-backdrop.visible {
      display: flex;
    }

    .modal {
      max-width: 420px;
      width: 100%;
      background: linear-gradient(145deg, #fff8ec, #ffe7c4);
      border-radius: 22px;
      box-shadow: 0 26px 70px rgba(26, 8, 0, 0.9);
      border: 1px solid rgba(160, 118, 78, 0.4);
      padding: 0.9rem 0.95rem 0.9rem;
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.35rem;
      gap: 0.4rem;
    }

    .modal-title {
      font-family: "Playfair Display", serif;
      font-size: 1.05rem;
      color: #3b2414;
    }

    .modal-close {
      border: none;
      background: transparent;
      font-size: 1rem;
      cursor: pointer;
      color: #7a5533;
    }

    .modal-body {
      font-size: 0.86rem;
      color: #5d3a1f;
      line-height: 1.5;
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 0.2rem;
    }

    .modal-body h4 {
      font-size: 0.9rem;
      margin: 0.35rem 0 0.1rem;
      color: #4f2b14;
    }

    .modal-body p {
      margin-bottom: 0.2rem;
    }

    .key-hints {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.2rem;
    }

    .key-chip {
      padding: 0.2rem 0.4rem;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px dashed rgba(160, 118, 78, 0.6);
      font-size: 0.75rem;
      color: #6a4831;
    }

    .achievements-list {
      list-style: none;
      margin: 0.3rem 0 0;
      padding: 0;
    }

    .achievements-list li {
      padding: 0.22rem 0;
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
      border-bottom: 1px dashed rgba(173, 135, 98, 0.3);
      font-size: 0.84rem;
    }

    .achievements-list li span.label {
      font-weight: 500;
    }

    .achievements-list li span.status {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .achievements-list li span.status.unlocked {
      color: var(--success);
    }

    .achievements-list li span.status.locked {
      color: #b39a7d;
    }

    footer.page-footer {
      margin-top: 0.8rem;
      font-size: 0.78rem;
      text-align: center;
      color: #7a5533;
      opacity: 0.88;
    }

    footer.page-footer span {
      font-family: "Schoolbell", system-ui;
    }

    @media (max-width: 960px) {
      .shell {
        padding: 1rem 0.9rem 1.2rem;
        border-radius: 26px;
      }

      header.story-hero {
        flex-direction: row;
        align-items: flex-start;
      }

      .hero-text {
        flex: 1.2;
      }

      .hero-figure {
        flex: 0.8;
        justify-content: flex-end;
      }

      .layout {
        grid-template-columns: minmax(0, 1fr);
      }

      .layout > .panel.game-panel {
        order: -1;
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 0.5rem;
      }

      .shell {
        padding: 0.9rem 0.65rem 1rem;
        border-radius: 22px;
      }

      header.story-hero {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .hero-figure {
        align-self: center;
        justify-content: center;
      }

      .bear-card {
        width: 150px;
        height: 150px;
      }

      .panel {
        padding: 0.85rem;
        border-radius: 20px;
      }

      .stat-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .control-row {
        flex-direction: column;
        align-items: stretch;
      }

      .control-group-main,
      .control-group-secondary {
        width: 100%;
        justify-content: space-between;
      }

      .game-canvas-shell {
        padding: 0.5rem;
      }

      .mobile-controls {
        display: flex;
      }

      .control-group-secondary .btn-small[data-action="help"],
      .control-group-secondary .btn-small[data-action="achievements"] {
        flex: 1;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <a href="#gameRegion" class="skip-link">Skip to game</a>
  <div class="shell">
    <header class="story-hero" aria-label="Pooh's Honey Barrel story heading">
      <div class="hero-text">
        <div class="hero-kicker">Baby Gunner's Hundred Acre Adventure</div>
        <h1 class="hero-title">Pooh's Honey Barrel</h1>
        <p class="hero-subtitle">Guide a very honey-loving bear under the falling drops, dodge the bees, and see how full you can get the barrel before time runs out.</p>
        <div class="hero-tag-row">
          <span class="pill"><span>üçØ</span> Honey catch mini-game</span>
          <span class="pill"><span>üêù</span> Dodge the bees</span>
          <span class="pill"><span>üì±</span> Built for phones & desktops</span>
        </div>
      </div>
      <div class="hero-figure" aria-hidden="true">
        <div class="bear-card">
          <div class="bear-inner"></div>
          <div class="bear-ears"></div>
          <div class="bear-face">
            <div class="bear-eyes"></div>
            <div class="bear-nose"></div>
            <div class="bear-mouth"></div>
          </div>
          <div class="bear-shirt"></div>
          <div class="bear-barrel"></div>
        </div>
      </div>
    </header>

    <main>
      <section class="layout" aria-label="Story and game area">
        <article class="panel game-panel" id="gameRegion">
          <div class="panel-inner game-shell">
            <div class="panel-header">
              <h2 class="panel-title">
                <span class="icon">üçØ</span>
                <span>Honey Catch Game</span>
              </h2>
              <span class="badge-soft">1‚Äì2 minutes of cozy chaos</span>
            </div>

            <div class="stat-row" aria-label="Game status">
              <div class="stat-group-main">
                <div class="stat-chip" aria-live="polite">
                  <div class="stat-label">Score</div>
                  <div class="stat-value"><span id="scoreValue">0</span></div>
                </div>
                <div class="stat-chip" aria-live="polite">
                  <div class="stat-label">Time</div>
                  <div class="stat-value"><span id="timeValue">60</span><span class="small">s</span></div>
                </div>
                <div class="stat-chip">
                  <div class="stat-label">Honey streak</div>
                  <div class="stat-value"><span id="streakValue">0</span><span class="small">x</span></div>
                </div>
                <div class="stat-chip" aria-label="Lives remaining">
                  <div class="stat-label">Honey hearts</div>
                  <div class="stat-value">
                    <div class="lives-indicator" id="livesIndicator" aria-hidden="true">
                      <div class="heart"></div>
                      <div class="heart"></div>
                      <div class="heart"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <span class="chip-secondary">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M5 4h14l-1.5 15.5L12 22l-5.5-2.5L5 4zM8 4V2h8v2" fill="none" stroke="#8a6647" stroke-width="1.6" stroke-linejoin="round" />
                  </svg>
                  <span>Best: <span id="bestScoreValue">0</span></span>
                </span>
              </div>
            </div>

            <div class="game-canvas-shell" aria-label="Game area">
              <div class="game-canvas-wrapper">
                <canvas id="gameCanvas" role="img" aria-label="Pooh with a barrel catching honey drops and avoiding bees"></canvas>
                <div class="game-overlay" id="gameOverlay">
                  <h3 class="overlay-title" id="overlayTitle">Ready to catch some honey?</h3>
                  <p class="overlay-subtitle" id="overlaySubtitle">
                    Move left and right to keep the barrel under the honey. Drops add points, bees sting your streak. Fill the barrel before the timer runs out.
                  </p>
                  <div class="overlay-stat-row" id="overlayStats" aria-hidden="true">
                    <div class="overlay-stat">Score: <span id="overlayScore">0</span></div>
                    <div class="overlay-stat">Best: <span id="overlayBest">0</span></div>
                    <div class="overlay-stat">Honey caught: <span id="overlayHoney">0</span></div>
                    <div class="overlay-stat">Bees dodged: <span id="overlayBees">0</span></div>
                  </div>
                  <div class="btn-row">
                    <button class="btn btn-primary" id="primaryOverlayBtn">
                      <span class="icon">‚ñ∂</span>
                      <span>Start catching honey</span>
                    </button>
                    <button class="btn btn-ghost btn-small" id="howToPlayOverlayBtn" type="button">
                      <span>How to play</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="control-row">
              <div class="control-group-main">
                <button class="btn btn-primary" id="startBtn">
                  <span class="icon">‚ñ∂</span>
                  <span>Start</span>
                </button>
                <button class="btn btn-ghost" id="pauseBtn">
                  <span class="icon">‚è∏</span>
                  <span>Pause</span>
                </button>

                <div class="difficulty-toggle" aria-label="Difficulty">
                  <button type="button" data-difficulty="easy" class="active">Gentle drizzle</button>
                  <button type="button" data-difficulty="normal">Honey shower</button>
                  <button type="button" data-difficulty="hard">Bee storm</button>
                </div>
              </div>

              <div class="control-group-secondary">
                <label class="toggle">
                  <input type="checkbox" id="soundToggle" checked />
                  <span class="toggle-pill"><span class="toggle-thumb"></span></span>
                  <span>Sound</span>
                </label>
                <button class="btn btn-ghost btn-small" id="helpBtn" data-action="help" type="button">
                  <span class="icon">‚ùî</span>
                  <span>How to play</span>
                </button>
                <button class="btn btn-ghost btn-small" id="achievementsBtn" data-action="achievements" type="button">
                  <span class="icon">üèÖ</span>
                  <span>Honey feats</span>
                </button>
              </div>
            </div>

            <div class="mobile-controls" aria-label="On-screen movement controls">
              <button class="btn" id="moveLeftBtn" type="button">
                <span class="icon">‚¨Ö</span>
                <span>Move left</span>
              </button>
              <button class="btn" id="moveRightBtn" type="button">
                <span class="icon">Move right</span>
                <span class="icon">‚û°</span>
              </button>
            </div>

            <div class="status-bar" id="statusBar" data-state="idle" aria-live="polite">
              <div style="display:flex; align-items:center; gap:0.3rem;">
                <span class="status-dot"></span>
                <span class="label" id="statusLabel">Ready when you are.</span>
              </div>
              <span>Keyboard: ‚Üê ‚Üí or A / D ¬∑ Touch: drag or big buttons</span>
            </div>
          </div>
        </article>

        <aside class="panel story-panel" aria-label="Story and tips">
          <div class="panel-inner story-shell">
            <section class="storybook-card" aria-label="Storybook setup">
              <header>
                <div class="storybook-heading">A very small story for a very big honey day</div>
                <h2 class="storybook-title">Baby Gunner's Honey Barrel Test</h2>
              </header>
              <div class="storybook-body">
                <p>
                  Deep in the Hundred Acre Wood, a certain round bear has been practicing for Baby Gunner's celebration:
                  carrying a barrel that's nearly as big as he is, just to make sure there's enough honey for everyone.
                </p>
                <p>
                  Your job is simple: keep that barrel in just the right spot. Honey falls from the sky in golden drops,
                  and helpful bees zoom past with mixed opinions about sharing. Catch the honey, skip the stings.
                </p>
              </div>
              <footer class="storybook-footer">
                <span class="storybook-tagline">The more honey you catch, the fuller the party feels.</span>
                <span>‚è± 60-second rounds</span>
              </footer>
            </section>

            <section aria-label="Tips">
              <div class="tip-list">
                <div class="tip-item">
                  <span class="tip-icon">‚≠ê</span>
                  <div>
                    <span class="tip-label">Build a streak.</span>
                    The more honey you catch without a bee bump, the faster your score climbs.
                  </div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üêù</span>
                  <div>
                    <span class="tip-label">Bees reset your rhythm.</span>
                    A sting knocks your streak down and nudges a heart away.
                  </div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üì±</span>
                  <div>
                    <span class="tip-label">On phones, go thumbs-only.</span>
                    Use the big left/right buttons right under the game or drag the bear directly.
                  </div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üß∏</span>
                  <div>
                    <span class="tip-label">Short and sweet.</span>
                    Rounds are designed to be quick enough for a party, but replayable for score-chasers.
                  </div>
                </div>
              </div>
            </section>

            <section class="status-bar" data-state="idle" aria-label="Party note">
              <div style="display:flex; align-items:center; gap:0.3rem;">
                <span class="status-dot"></span>
                <span class="label">Party mode ready.</span>
              </div>
              <span>Perfect as a warm-up while guests arrive.</span>
            </section>
          </div>
        </aside>
      </section>
    </main>

    <footer class="page-footer">
      Built with <span>just a smackerel of code</span> for Baby Gunner's Hundred Acre celebration.
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <span class="icon" aria-hidden="true">üçØ</span>
    <span id="toastMessage">Honey streak!</span>
  </div>

  <div class="modal-backdrop" id="helpModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
      <div class="modal-header">
        <h3 class="modal-title" id="helpModalTitle">How to play</h3>
        <button class="modal-close" type="button" data-close-modal="help">
          ‚úï
        </button>
      </div>
      <div class="modal-body">
        <h4>Goal</h4>
        <p>Catch as many honey drops as you can before the timer reaches zero. Avoid the bees ‚Äì they knock you off your honey rhythm.</p>

        <h4>Controls</h4>
        <p><strong>Desktop &amp; laptop</strong></p>
        <div class="key-hints">
          <span class="key-chip">‚Üê / ‚Üí</span>
          <span class="key-chip">A / D</span>
        </div>
        <p>Use the arrow or A / D keys to move the bear and barrel left and right.</p>
        <p><strong>Phones &amp; tablets</strong></p>
        <ul style="margin-left:1.1rem; padding-left:0; margin-top:0.15rem;">
          <li>Tap and drag directly on the game to slide the bear.</li>
          <li>Or use the big <em>Move left</em> / <em>Move right</em> buttons under the game.</li>
        </ul>

        <h4>Scoring &amp; streaks</h4>
        <p>Each honey drop adds to your score. Catch several in a row and your streak climbs, giving bonus points every few drops.</p>
        <p>A bee hit:</p>
        <ul style="margin-left:1.1rem; padding-left:0; margin-top:0.15rem;">
          <li>Resets your streak.</li>
          <li>Removes a heart. Lose all hearts and the round ends early.</li>
        </ul>

        <h4>Difficulty</h4>
        <p>Use the difficulty buttons beside the Start button:</p>
        <ul style="margin-left:1.1rem; padding-left:0; margin-top:0.15rem;">
          <li><strong>Gentle drizzle</strong> ‚Äì Slower drops, fewer bees.</li>
          <li><strong>Honey shower</strong> ‚Äì Balanced for most players.</li>
          <li><strong>Bee storm</strong> ‚Äì Fast, busy, and buzzy.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="achievementsModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="achievementsModalTitle">
      <div class="modal-header">
        <h3 class="modal-title" id="achievementsModalTitle">Honey feats</h3>
        <button class="modal-close" type="button" data-close-modal="achievements">
          ‚úï
        </button>
      </div>
      <div class="modal-body">
        <p>Try unlocking these little milestones as you play. They stay in this browser only.</p>
        <ul class="achievements-list" id="achievementsList">
          <li>
            <span class="label">First honey</span>
            <span class="status locked" data-achievement="firstHoney">Locked</span>
          </li>
          <li>
            <span class="label">No-sting round</span>
            <span class="status locked" data-achievement="noSting">Locked</span>
          </li>
          <li>
            <span class="label">Honey hero (50+)</span>
            <span class="status locked" data-achievement="fiftyScore">Locked</span>
          </li>
          <li>
            <span class="label">Barrel champion (100+)</span>
            <span class="status locked" data-achievement="hundredScore">Locked</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const canvas = document.getElementById("gameCanvas");
      const overlay = document.getElementById("gameOverlay");
      const overlayTitle = document.getElementById("overlayTitle");
      const overlaySubtitle = document.getElementById("overlaySubtitle");
      const overlayStatsRow = document.getElementById("overlayStats");
      const overlayScore = document.getElementById("overlayScore");
      const overlayBest = document.getElementById("overlayBest");
      const overlayHoney = document.getElementById("overlayHoney");
      const overlayBees = document.getElementById("overlayBees");
      const primaryOverlayBtn = document.getElementById("primaryOverlayBtn");
      const howToPlayOverlayBtn = document.getElementById("howToPlayOverlayBtn");

      const scoreEl = document.getElementById("scoreValue");
      const timeEl = document.getElementById("timeValue");
      const streakEl = document.getElementById("streakValue");
      const bestScoreEl = document.getElementById("bestScoreValue");
      const livesIndicator = document.getElementById("livesIndicator");
      const statusBar = document.getElementById("statusBar");
      const statusLabel = document.getElementById("statusLabel");

      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const diffButtons = Array.from(document.querySelectorAll(".difficulty-toggle button"));
      const soundToggle = document.getElementById("soundToggle");

      const moveLeftBtn = document.getElementById("moveLeftBtn");
      const moveRightBtn = document.getElementById("moveRightBtn");

      const toast = document.getElementById("toast");
      const toastMessage = document.getElementById("toastMessage");

      const helpModalBackdrop = document.getElementById("helpModalBackdrop");
      const achievementsModalBackdrop = document.getElementById("achievementsModalBackdrop");
      const helpBtn = document.getElementById("helpBtn");
      const achievementsBtn = document.getElementById("achievementsBtn");
      const achievementsList = document.getElementById("achievementsList");

      const ctx = canvas.getContext("2d");

      const GAME_STATE = {
        IDLE: "idle",
        RUNNING: "running",
        PAUSED: "paused",
        OVER: "over",
      };

      const defaultConfig = {
        baseDuration: 60,
        baseHoneySpawn: 900,
        baseBeeSpawn: 2100,
        easyMultiplier: 1.2,
        hardMultiplier: 0.65,
        honeySpeedBase: 120,
        beeSpeedBase: 130,
        streakBonusStep: 5,
        maxLives: 3,
      };

      const DIFFICULTY = {
        easy: "easy",
        normal: "normal",
        hard: "hard",
      };

      const sounds = {
        catch: null,
        bee: null,
        streak: null,
        end: null,
      };

      function createClickSound(frequency) {
        const ctxAudio = new (window.AudioContext || window.webkitAudioContext)();
        return function () {
          if (!soundToggle.checked) return;
          const osc = ctxAudio.createOscillator();
          const gain = ctxAudio.createGain();
          osc.type = "triangle";
          osc.frequency.value = frequency;
          osc.connect(gain);
          gain.connect(ctxAudio.destination);
          const now = ctxAudio.currentTime;
          gain.gain.setValueAtTime(0.18, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
          osc.start(now);
          osc.stop(now + 0.2);
        };
      }

      try {
        sounds.catch = createClickSound(640);
        sounds.bee = createClickSound(320);
        sounds.streak = createClickSound(880);
        sounds.end = createClickSound(220);
      } catch (e) {
      }

      let gameState = GAME_STATE.IDLE;
      let difficulty = DIFFICULTY.easy;

      let width = 0;
      let height = 0;

      const bear = {
        x: 0,
        y: 0,
        width: 70,
        height: 70,
        speed: 260,
        targetDirection: 0,
      };

      let honeyDrops = [];
      let bees = [];

      let score = 0;
      let bestScore = 0;
      let timeRemaining = defaultConfig.baseDuration;
      let lastFrameTime = 0;
      let lastHoneySpawn = 0;
      let lastBeeSpawn = 0;
      let honeyCaught = 0;
      let beesDodged = 0;
      let streak = 0;
      let lives = defaultConfig.maxLives;

      let leftPressed = false;
      let rightPressed = false;
      let dragging = false;
      let dragOffsetX = 0;

      let achievements = {
        firstHoney: false,
        noSting: false,
        fiftyScore: false,
        hundredScore: false,
      };

      function restoreBestScore() {
        try {
          const stored = localStorage.getItem("poohHoneyBestScore");
          if (stored) {
            bestScore = parseInt(stored, 10) || 0;
            bestScoreEl.textContent = bestScore;
          }
          const storedAchievements = localStorage.getItem("poohHoneyAchievements");
          if (storedAchievements) {
            achievements = Object.assign(achievements, JSON.parse(storedAchievements));
          }
        } catch (e) {}
        refreshAchievementsUI();
      }

      function saveBestScore() {
        try {
          localStorage.setItem("poohHoneyBestScore", String(bestScore));
        } catch (e) {}
      }

      function saveAchievements() {
        try {
          localStorage.setItem("poohHoneyAchievements", JSON.stringify(achievements));
        } catch (e) {}
      }

      function refreshAchievementsUI() {
        if (!achievementsList) return;
        achievementsList.querySelectorAll("[data-achievement]").forEach((el) => {
          const key = el.getAttribute("data-achievement");
          const unlocked = achievements[key];
          el.textContent = unlocked ? "Unlocked" : "Locked";
          el.classList.toggle("unlocked", !!unlocked);
          el.classList.toggle("locked", !unlocked);
        });
      }

      function unlockAchievement(key) {
        if (!achievements[key]) {
          achievements[key] = true;
          refreshAchievementsUI();
          saveAchievements();
          showToast("Achievement unlocked: " + formatAchievementName(key));
        }
      }

      function formatAchievementName(key) {
        switch (key) {
          case "firstHoney":
            return "First honey!";
          case "noSting":
            return "No-sting round";
          case "fiftyScore":
            return "Honey hero (50+)";
          case "hundredScore":
            return "Barrel champion (100+)";
          default:
            return key;
        }
      }

      function showToast(message) {
        if (!toast) return;
        toastMessage.textContent = message;
        toast.classList.add("visible");
        setTimeout(() => {
          toast.classList.remove("visible");
        }, 1800);
      }

      function resizeCanvas() {
        const wrapper = canvas.parentElement;
        if (!wrapper) return;
        const rect = wrapper.getBoundingClientRect();
        const devicePixelRatio = window.devicePixelRatio || 1;
        width = rect.width * devicePixelRatio;
        height = rect.height * devicePixelRatio;
        canvas.width = width;
        canvas.height = height;
        ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
        bear.y = rect.height - bear.height - 12;
        bear.x = rect.width / 2 - bear.width / 2;
      }

      function getDifficultyFactor() {
        switch (difficulty) {
          case DIFFICULTY.easy:
            return defaultConfig.easyMultiplier;
          case DIFFICULTY.hard:
            return defaultConfig.hardMultiplier;
          default:
            return 1;
        }
      }

      function resetGameState(preserveDifficulty) {
        const duration = defaultConfig.baseDuration;
        score = 0;
        timeRemaining = duration;
        lastHoneySpawn = 0;
        lastBeeSpawn = 0;
        honeyDrops = [];
        bees = [];
        honeyCaught = 0;
        beesDodged = 0;
        streak = 0;
        lives = defaultConfig.maxLives;
        leftPressed = rightPressed = false;
        dragging = false;
        dragOffsetX = 0;
        updateScoreUI();
        updateTimeUI();
        updateStreakUI();
        updateLivesUI();
        updateStatusBar("Ready when you are.", GAME_STATE.IDLE);
        if (!preserveDifficulty) difficulty = DIFFICULTY.easy;
      }

      function updateScoreUI() {
        scoreEl.textContent = score;
        bestScoreEl.textContent = bestScore;
      }

      function updateTimeUI() {
        timeEl.textContent = Math.max(0, Math.floor(timeRemaining));
      }

      function updateStreakUI() {
        streakEl.textContent = streak;
      }

      function updateLivesUI() {
        if (!livesIndicator) return;
        const hearts = livesIndicator.querySelectorAll(".heart");
        hearts.forEach((heart, idx) => {
          heart.classList.toggle("lost", idx >= lives);
        });
      }

      function updateStatusBar(message, state) {
        statusLabel.textContent = message;
        statusBar.dataset.state = state || statusBar.dataset.state || GAME_STATE.IDLE;
      }

      function setGameState(newState) {
        gameState = newState;
        statusBar.dataset.state = newState;
      }

      function spawnHoney() {
        const wrapperRect = canvas.parentElement.getBoundingClientRect();
        const x = 20 + Math.random() * (wrapperRect.width - 40);
        honeyDrops.push({
          x,
          y: -20,
          radius: 10 + Math.random() * 4,
          speed: defaultConfig.honeySpeedBase * getDifficultyFactor() * (0.8 + Math.random() * 0.4),
        });
      }

      function spawnBee() {
        const wrapperRect = canvas.parentElement.getBoundingClientRect();
        const x = 20 + Math.random() * (wrapperRect.width - 40);
        bees.push({
          x,
          y: -24,
          size: 18,
          speed: defaultConfig.beeSpeedBase * getDifficultyFactor() * (0.9 + Math.random() * 0.4),
          zigzagPhase: Math.random() * Math.PI * 2,
        });
      }

      function drawBackground() {
        const w = canvas.clientWidth;
        const h = canvas.clientHeight;
        const skyHeight = h * 0.55;
        const grassHeight = h * 0.45;
        const gradientSky = ctx.createLinearGradient(0, 0, 0, skyHeight);
        gradientSky.addColorStop(0, "#b9e6ff");
        gradientSky.addColorStop(1, "#fff7d4");
        ctx.fillStyle = gradientSky;
        ctx.fillRect(0, 0, w, skyHeight);
        const gradientGrass = ctx.createLinearGradient(0, skyHeight, 0, h);
        gradientGrass.addColorStop(0, "#c8e6a0");
        gradientGrass.addColorStop(1, "#9acb6a");
        ctx.fillStyle = gradientGrass;
        ctx.fillRect(0, skyHeight, w, h - skyHeight);
        ctx.fillStyle = "rgba(255,255,255,0.8)";
        for (let i = 0; i < 3; i++) {
          const cloudX = (w / 4) * i + 40;
          const cloudY = 40 + (i % 2) * 20;
          ctx.beginPath();
          ctx.ellipse(cloudX, cloudY, 45, 22, 0, 0, Math.PI * 2);
          ctx.ellipse(cloudX + 30, cloudY + 10, 35, 18, 0, 0, Math.PI * 2);
          ctx.ellipse(cloudX - 25, cloudY + 8, 30, 16, 0, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.fillStyle = "#f7c948";
        ctx.beginPath();
        ctx.arc(w - 40, 38, 22, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 0.14;
        ctx.fillStyle = "#f7c948";
        ctx.beginPath();
        ctx.arc(w - 40, 38, 42, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      function drawBear() {
        const px = bear.x;
        const py = bear.y;
        const bw = bear.width;
        const bh = bear.height;
        ctx.save();
        ctx.fillStyle = "#f3b547";
        const headRadius = 18;
        const headX = px + bw / 2;
        const headY = py + 22;
        ctx.beginPath();
        ctx.arc(headX, headY, headRadius, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(headX - 10, headY - 12, 8, 0, Math.PI * 2);
        ctx.arc(headX + 10, headY - 12, 8, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#f8d48a";
        ctx.beginPath();
        ctx.arc(headX, headY + 4, 10, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#3b2414";
        ctx.beginPath();
        ctx.arc(headX - 6, headY - 2, 2, 0, Math.PI * 2);
        ctx.arc(headX + 6, headY - 2, 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(headX, headY + 2, 2.8, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "#3b2414";
        ctx.lineWidth = 1.4;
        ctx.beginPath();
        ctx.arc(headX, headY + 8, 7, 0.15 * Math.PI, 0.85 * Math.PI);
        ctx.stroke();
        const bodyWidth = 32;
        const bodyHeight = 26;
        const bodyX = headX - bodyWidth / 2;
        const bodyY = headY + 12;
        ctx.fillStyle = "#e65a3b";
        ctx.beginPath();
        ctx.roundRect(bodyX, bodyY, bodyWidth, bodyHeight, 8);
        ctx.fill();
        ctx.fillStyle = "#f3b547";
        const legWidth = 10;
        const legHeight = 14;
        ctx.beginPath();
        ctx.roundRect(bodyX + 4, bodyY + bodyHeight - 4, legWidth, legHeight, 5);
        ctx.roundRect(bodyX + bodyWidth - legWidth - 4, bodyY + bodyHeight - 4, legWidth, legHeight, 5);
        ctx.fill();
        const barrelWidth = 40;
        const barrelHeight = 32;
        const barrelX = bodyX + bodyWidth / 2 - barrelWidth / 2;
        const barrelY = bodyY + 6;
        ctx.fillStyle = "#c47a3d";
        ctx.beginPath();
        ctx.roundRect(barrelX, barrelY, barrelWidth, barrelHeight, 10);
        ctx.fill();
        ctx.fillStyle = "#e1a35d";
        ctx.fillRect(barrelX + 4, barrelY + 5, barrelWidth - 8, barrelHeight - 12);
        ctx.strokeStyle = "rgba(92,56,28,0.9)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(barrelX + 3, barrelY + 9);
        ctx.lineTo(barrelX + barrelWidth - 3, barrelY + 9);
        ctx.moveTo(barrelX + 3, barrelY + barrelHeight - 8);
        ctx.lineTo(barrelX + barrelWidth - 3, barrelY + barrelHeight - 8);
        ctx.stroke();
        ctx.fillStyle = "#fbd56a";
        ctx.beginPath();
        ctx.arc(barrelX + barrelWidth / 2, barrelY + barrelHeight / 2 + 1, 7, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      function drawHoneyDrop(drop) {
        ctx.save();
        ctx.fillStyle = "#f7c948";
        ctx.beginPath();
        ctx.ellipse(drop.x, drop.y, drop.radius, drop.radius * 1.25, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,0.8)";
        ctx.beginPath();
        ctx.ellipse(drop.x - drop.radius * 0.3, drop.y - drop.radius * 0.2, drop.radius * 0.35, drop.radius * 0.35, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      function drawBee(bee, time) {
        ctx.save();
        const wobble = Math.sin(time / 220 + bee.zigzagPhase) * 4;
        const x = bee.x + wobble;
        const y = bee.y;
        ctx.translate(x, y);
        ctx.fillStyle = "#ffdd75";
        ctx.beginPath();
        ctx.ellipse(0, 0, 12, 9, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#3b2414";
        ctx.fillRect(-8, -2, 4, 4);
        ctx.fillRect(-2, -3, 4, 6);
        ctx.fillRect(4, -2, 4, 4);
        ctx.fillStyle = "#3b2414";
        ctx.beginPath();
        ctx.arc(11, 0, 4.5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.ellipse(-2, -9, 11, 7, -0.35, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(4, -9, 11, 7, 0.35, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#3b2414";
        ctx.beginPath();
        ctx.arc(13, -1.2, 1.2, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(11.2, -0.2, 1.2, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
        return ax < bx + bw && ax + aw > bx && ay < by + bh && ah + ay > by;
      }

      function stepEntities(delta, currentTime) {
        const wrapperRect = canvas.parentElement.getBoundingClientRect();
        const h = wrapperRect.height;
        const factor = getDifficultyFactor();
        const honeySpawnInterval =
          defaultConfig.baseHoneySpawn * (difficulty === DIFFICULTY.easy ? 1.2 : difficulty === DIFFICULTY.hard ? 0.75 : 1);
        const beeSpawnInterval =
          defaultConfig.baseBeeSpawn * (difficulty === DIFFICULTY.easy ? 1.4 : difficulty === DIFFICULTY.hard ? 0.7 : 1);
        if (currentTime - lastHoneySpawn > honeySpawnInterval) {
          spawnHoney();
          lastHoneySpawn = currentTime;
        }
        if (currentTime - lastBeeSpawn > beeSpawnInterval) {
          spawnBee();
          lastBeeSpawn = currentTime;
        }
        const speedFactor = factor;
        honeyDrops.forEach((drop) => {
          drop.y += (drop.speed * delta * speedFactor) / 1000;
        });
        bees.forEach((bee) => {
          bee.y += (bee.speed * delta * speedFactor) / 1000;
        });
        honeyDrops = honeyDrops.filter((drop) => drop.y - drop.radius < h + 30);
        bees = bees.filter((bee) => bee.y - bee.size < h + 40);
      }

      function checkCollisions() {
        const wrapperRect = canvas.parentElement.getBoundingClientRect();
        const bearRect = {
          x: bear.x + 5,
          y: bear.y + 10,
          width: bear.width - 10,
          height: bear.height - 10,
        };
        honeyDrops = honeyDrops.filter((drop) => {
          const dropRect = {
            x: drop.x - drop.radius,
            y: drop.y - drop.radius,
            width: drop.radius * 2,
            height: drop.radius * 2,
          };
          if (rectsOverlap(bearRect.x, bearRect.y, bearRect.width, bearRect.height, dropRect.x, dropRect.y, dropRect.width, dropRect.height)) {
            honeyCaught++;
            score += 1 + Math.floor(streak / defaultConfig.streakBonusStep);
            streak++;
            if (score >= 50) unlockAchievement("fiftyScore");
            if (score >= 100) unlockAchievement("hundredScore");
            if (honeyCaught === 1) unlockAchievement("firstHoney");
            updateScoreUI();
            updateStreakUI();
            if (streak > 0 && streak % defaultConfig.streakBonusStep === 0) {
              showToast("Honey streak x" + streak + "!");
              if (sounds.streak) sounds.streak();
            } else {
              if (sounds.catch) sounds.catch();
            }
            return false;
          }
          return true;
        });
        bees = bees.filter((bee) => {
          const beeRect = {
            x: bee.x - 12,
            y: bee.y - 10,
            width: 24,
            height: 20,
          };
          if (rectsOverlap(bearRect.x, bearRect.y, bearRect.width, bearRect.height, beeRect.x, beeRect.y, beeRect.width, beeRect.height)) {
            streak = 0;
            updateStreakUI();
            lives = Math.max(0, lives - 1);
            updateLivesUI();
            if (sounds.bee) sounds.bee();
            return false;
          }
          if (bee.y > wrapperRect.height + 20) {
            beesDodged++;
          }
          return true;
        });
      }

      function updateBear(delta) {
        const wrapperRect = canvas.parentElement.getBoundingClientRect();
        let direction = 0;
        if (leftPressed && !rightPressed) direction = -1;
        if (rightPressed && !leftPressed) direction = 1;
        bear.x += direction * bear.speed * (delta / 1000);
        bear.x = Math.max(6, Math.min(wrapperRect.width - bear.width - 6, bear.x));
      }

      function gameLoop(timestamp) {
        if (lastFrameTime === 0) lastFrameTime = timestamp;
        const delta = timestamp - lastFrameTime;
        lastFrameTime = timestamp;
        if (gameState === GAME_STATE.RUNNING) {
          timeRemaining -= delta / 1000;
          if (timeRemaining <= 0 || lives <= 0) {
            timeRemaining = 0;
            endGame();
          }
          stepEntities(delta, timestamp);
          checkCollisions();
          updateTimeUI();
          updateStatusBar("Keep that barrel under the honey...", GAME_STATE.RUNNING);
        }
        ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
        drawBackground();
        honeyDrops.forEach((drop) => drawHoneyDrop(drop));
        bees.forEach((bee) => drawBee(bee, timestamp));
        updateBear(delta);
        drawBear();
        requestAnimationFrame(gameLoop);
      }

      function startGame(fromOverlay) {
        if (gameState === GAME_STATE.RUNNING) return;
        overlay.classList.add("hidden");
        overlayStatsRow.setAttribute("aria-hidden", "true");
        setGameState(GAME_STATE.RUNNING);
        updateStatusBar("Honey is falling!", GAME_STATE.RUNNING);
        if (fromOverlay) {
          resetGameState(true);
        }
      }

      function hardResetAndStart() {
        resetGameState(true);
        overlay.classList.add("hidden");
        overlayStatsRow.setAttribute("aria-hidden", "true");
        setGameState(GAME_STATE.RUNNING);
        updateStatusBar("Honey is falling!", GAME_STATE.RUNNING);
      }

      function pauseGame() {
        if (gameState !== GAME_STATE.RUNNING) return;
        setGameState(GAME_STATE.PAUSED);
        updateStatusBar("Paused. Stretch your paws.", GAME_STATE.PAUSED);
      }

      function resumeGame() {
        if (gameState !== GAME_STATE.PAUSED) return;
        setGameState(GAME_STATE.RUNNING);
        updateStatusBar("Back to honey catching!", GAME_STATE.RUNNING);
      }

      function endGame() {
        if (gameState === GAME_STATE.OVER || gameState === GAME_STATE.IDLE) return;
        setGameState(GAME_STATE.OVER);
        if (sounds.end) sounds.end();
        const tookNoSting = bees.length === 0 && lives === defaultConfig.maxLives;
        if (tookNoSting) unlockAchievement("noSting");
        if (score > bestScore) {
          bestScore = score;
          saveBestScore();
        }
        updateScoreUI();
        overlayTitle.textContent = lives <= 0 ? "Bee bump! Round over." : "Time's up!";
        overlaySubtitle.textContent =
          score > 0
            ? "Nice work. Want to try for a higher score or a no-sting round?"
            : "No honey just yet ‚Äì try a gentler drizzle or move sooner when you see the first drops.";
        overlayScore.textContent = score;
        overlayBest.textContent = bestScore;
        overlayHoney.textContent = honeyCaught;
        overlayBees.textContent = beesDodged;
        overlayStatsRow.setAttribute("aria-hidden", "false");
        overlay.classList.remove("hidden");
        updateStatusBar("Round complete. Ready when you are.", GAME_STATE.OVER);
      }

      function setDifficulty(level) {
        difficulty = level;
        diffButtons.forEach((btn) => {
          btn.classList.toggle("active", btn.getAttribute("data-difficulty") === level);
        });
        const label =
          level === DIFFICULTY.easy
            ? "Gentle drizzle selected."
            : level === DIFFICULTY.hard
            ? "Bee storm selected. Buzz-y!"
            : "Honey shower selected.";
        showToast(label);
      }

      function showModal(which) {
        const backdrop = which === "help" ? helpModalBackdrop : achievementsModalBackdrop;
        if (!backdrop) return;
        backdrop.classList.add("visible");
        backdrop.setAttribute("aria-hidden", "false");
      }

      function hideModal(which) {
        const backdrop = which === "help" ? helpModalBackdrop : achievementsModalBackdrop;
        if (!backdrop) return;
        backdrop.classList.remove("visible");
        backdrop.setAttribute("aria-hidden", "true");
      }

      function bindEvents() {
        window.addEventListener("resize", () => {
          resizeCanvas();
        });

        primaryOverlayBtn.addEventListener("click", () => {
          hardResetAndStart();
        });

        howToPlayOverlayBtn.addEventListener("click", () => {
          showModal("help");
        });

        startBtn.addEventListener("click", () => {
          if (gameState === GAME_STATE.RUNNING) {
            resetGameState(true);
            hardResetAndStart();
          } else if (gameState === GAME_STATE.PAUSED) {
            resumeGame();
          } else {
            hardResetAndStart();
          }
        });

        pauseBtn.addEventListener("click", () => {
          if (gameState === GAME_STATE.RUNNING) {
            pauseGame();
          } else if (gameState === GAME_STATE.PAUSED) {
            resumeGame();
          }
        });

        diffButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const level = btn.getAttribute("data-difficulty");
            setDifficulty(level);
          });
        });

        helpBtn.addEventListener("click", () => showModal("help"));
        achievementsBtn.addEventListener("click", () => showModal("achievements"));

        document.querySelectorAll(".modal-close").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const which = e.currentTarget.getAttribute("data-close-modal");
            hideModal(which);
          });
        });

        [helpModalBackdrop, achievementsModalBackdrop].forEach((backdrop) => {
          if (!backdrop) return;
          backdrop.addEventListener("click", (e) => {
            if (e.target === backdrop) {
              if (backdrop === helpModalBackdrop) hideModal("help");
              if (backdrop === achievementsModalBackdrop) hideModal("achievements");
            }
          });
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            hideModal("help");
            hideModal("achievements");
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "ArrowLeft" || e.key.toLowerCase() === "a") {
            leftPressed = true;
          }
          if (e.key === "ArrowRight" || e.key.toLowerCase() === "d") {
            rightPressed = true;
          }
        });

        document.addEventListener("keyup", (e) => {
          if (e.key === "ArrowLeft" || e.key.toLowerCase() === "a") {
            leftPressed = false;
          }
          if (e.key === "ArrowRight" || e.key.toLowerCase() === "d") {
            rightPressed = false;
          }
        });

        function onPointerDown(e) {
          const rect = canvas.getBoundingClientRect();
          const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
          const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
          const bearRect = {
            x: bear.x,
            y: bear.y,
            width: bear.width,
            height: bear.height,
          };
          if (
            x >= bearRect.x &&
            x <= bearRect.x + bearRect.width &&
            y >= bearRect.y &&
            y <= bearRect.y + bearRect.height
          ) {
            dragging = true;
            dragOffsetX = x - bear.x;
          } else {
            dragging = true;
            dragOffsetX = bear.width / 2;
            bear.x = x - dragOffsetX;
          }
        }

        function onPointerMove(e) {
          if (!dragging) return;
          const rect = canvas.getBoundingClientRect();
          const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
          bear.x = x - dragOffsetX;
          bear.x = Math.max(6, Math.min(rect.width - bear.width - 6, bear.x));
        }

        function onPointerUp() {
          dragging = false;
        }

        canvas.addEventListener("mousedown", onPointerDown);
        canvas.addEventListener("mousemove", onPointerMove);
        document.addEventListener("mouseup", onPointerUp);
        canvas.addEventListener("touchstart", (e) => {
          e.preventDefault();
          onPointerDown(e);
        }, { passive: false });
        canvas.addEventListener("touchmove", (e) => {
          e.preventDefault();
          onPointerMove(e);
        }, { passive: false });
        canvas.addEventListener("touchend", (e) => {
          e.preventDefault();
          onPointerUp();
        }, { passive: false });

        function bindHoldButton(btn, direction) {
          let active = false;
          const start = () => {
            active = true;
            if (direction < 0) {
              leftPressed = true;
              rightPressed = false;
            } else {
              rightPressed = true;
              leftPressed = false;
            }
          };
          const stop = () => {
            active = false;
            if (direction < 0) {
              leftPressed = false;
            } else {
              rightPressed = false;
            }
          };
          btn.addEventListener("mousedown", (e) => {
            e.preventDefault();
            start();
          });
          btn.addEventListener("mouseup", (e) => {
            e.preventDefault();
            stop();
          });
          btn.addEventListener("mouseleave", (e) => {
            if (active) stop();
          });
          btn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            start();
          }, { passive: false });
          btn.addEventListener("touchend", (e) => {
            e.preventDefault();
            stop();
          }, { passive: false });
          btn.addEventListener("touchcancel", (e) => {
            e.preventDefault();
            stop();
          }, { passive: false });
        }
        bindHoldButton(moveLeftBtn, -1);
        bindHoldButton(moveRightBtn, 1);
      }

      function init() {
        restoreBestScore();
        resizeCanvas();
        resetGameState(true);
        bindEvents();
        updateStatusBar("Use Start to begin. Difficulty can be changed any time.", GAME_STATE.IDLE);
        requestAnimationFrame(gameLoop);
      }

      window.addEventListener("load", init);
    })();
  </script>
</body>
</html>